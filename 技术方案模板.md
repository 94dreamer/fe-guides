# 技术方案规范

背景

PRD 地址：

效率平台地址：

后端技术方案链接：

目标

围绕三个问题讲清楚：为什么？价值如何评估？现在是否是最好的方案？

# 变更记录

方案有变更，需要实时更新在这里，并将改动同步通知给测试

| 版本 | 版本说明/变更原因 | 变更人 | 变更时间 |
| :--- | :---------------- | :----- | :------- |
|      |                   |        |          |

# 1 业务流程

建议使用时序图

# 2 整体架构

## 2.1 页面架构

- 单页
- 多页

## 2.2 应用依赖（前期有些不确定性）

项目应用哪些应用，当项目跨多个应用时，需要明确各应用的发布顺序。一般情况下发布顺序为：底层业务，如店铺，商品 ic，下单 → 上层垂直 java 业务，如课程、营销 → 最后才是前端应用

| 顺序 | 名称 | 分支 | 依赖 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
|      |      |      |      |      |
|      |      |      |      |      |

## 2.3 引入的第三方依赖

- 如第三方的富文本编辑器（示例）

# 3 结构设计

## 3.1 功能梳理图

建议绘制脑图方式，主要目的是为了明确需求的功能点

## 3.2 应用类型

- Node
- PC
- H5
- 微信小程序
- 百度小程序

## 3.3 文件层级

PC 端请按照凯文梳理的结构，在设计文件层级及路由时务必看下个业务域下的 readme 文件

H5 端也可参考 pc 端的目录结构

文件目录层级设计：请参考应用内 client/pages/a-sample-domain 及对应 readme 文件，同时一并阅读下业务域内 readme 文件

## 3.4 路由设计

路由设计务必按照下图格式进行，完成方案编写可删除图片

![img](imgs\url规范)

| Node |     |
| :--- | --- |
| 前端 |     |

# 4 组件设计

## 4.1 按原型拆分公共组件、简述数据流

pc 端拆分公共组件之前，可以看下组件库中是否有可用的组件

此处拆分公共组件，PC 端组件放在 client/components 下，h5 端可参考 pc 目录

| 需求 | 原型 | 组件                           |
| :--- | :--- | :----------------------------- |
|      |      | **组件拆分：\*\***数据流：\*\* |
|      |      | **组件拆分：\*\***数据流：\*\* |

## 4.2 按原型拆分业务组件、简述数据流

此处拆分业务组件，PC 端在 pages 目录下，h5 端可参考 pc 目录

![img](imgs\目录)

| 需求 | 原型 | 组件                           |
| :--- | :--- | :----------------------------- |
|      |      | **组件拆分：\*\***数据流：\*\* |
|      |      | **组件拆分：\*\***数据流：\*\* |

# 5 权限接入

涉及新增或修改权限的需求，在拆分任务时要把工作量加进去，确保已经了解过 sam 的流程，由谁配置发布

# 6 埋点需求

涉及埋点需求，跟产品将埋点确认清楚，记得拆分工作量，在项目上线一个月左右的时间时，记得去拉埋点数据，进行业务价值分析

# 7 项目依赖

是否有 A 项目依赖 B 项目，如有，在此进行说明

# 8 安全审查

- 富文本接口是否接入 XSS 过虑服务，[基于语法树的 HTML5 过滤服务](https://github.com/youzan/ngx_http_html_sanitize_module)
- 在使用 vue v-html/ react dangerouslySetInnerHTML 时是否有做 xss 处理
- Node 端使用的 kdtId 是否都从 ctx 上拿的
- 展示分享域名是否使用 shopxxxxx.xxx.com 开头

# 9 发布设计

## 9.1 发布方案

- 基于 kdtid 分流
- 基于用户分流
- 白名单
- 全量发布

## 9.2 发布顺序

参考 2.2 应用依赖

# 10 注意点

## 10.1 小程序问题

- 发布时标明体验版和稳定版对应的版本号
- 涉及到 H5 迁移原生场景时，且原生有改动时，评估是否依赖版本号跳转并同步给测试同学
- 是否由于特殊情况需要单独发稳定版（一般跟发版日历走）

## 10.2 公共修改部分及影响面评估

| 模块                | 回归 checklist                                         | 其他 |
| :------------------ | :----------------------------------------------------- | :--- |
| 内容&专栏详情       | 自营商品分销商品微信小程序 h5 百度小程序               |      |
| 详情页底部行动按钮  | 拼团限时折扣秒杀积分商城推荐有奖好友助力（微信小程序） |      |
| PC 端是否需要商品锁 | 内容专栏直播线下课                                     |      |
| 其他                |                                                        |      |

## 10.3 其它

可包括对现有功能的影响范围,尤其如果修改到共用组件或方法，需明确给测试同学要增加的回归范围

# 11 代码审查

## 11.1 Code Reviewer

- codereview 时间：冒烟结束，提测之前
- 任务拆分添加 Code Review 时间点和工时拆上
- 由 @xxx 进行 Code Review，默认 Review 顺序： 项目成员 → 业务组成员 → 模块 owner → 组长

## 11.2 review 节奏安排

比如按模块，或按组件

# 12 降级

- 页面降级
- Node 降级
- 其他降级
