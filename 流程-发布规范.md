> 日常需求，由于规模不大，易于完成，迭代效率高，因此频率会在一周一次。但是也是因为规模不大，往往容易漏测掉一些细节，导致各种意想不到的线上问题。文档从两方面来介绍日常发布流程。

## 【约定】

### 1.日常登记均在石墨文档，请关注【前端大本营】群和【日常发布】群的群公告信息，必须先登记

### 2.未登记的日常，不允许上车，一经发现，直接下车

### 3.已登记的日常，未开发完成之前，不允许先占坑位

### 4.日常若有依赖、配置关系，需在登记文档中注明

## 个人

### 【认领节奏】

1.日常分配时间：每周三下午之前

2.日常任务拆分：每周三下班之前

### 【开发节奏】

当个人认领到一个日常需求时，请不要急于完成，需要我们做以下几件事情，然后再确认，这个需求是否为一个日常，或者要以其他形式，如小项目的流程发布

![img](https://b.yzcdn.cn/public_files/2019/03/27/personal-daily-release.jpg)

1. 与对应 PD 确认清楚需求，保证待实现的需求与个人理解及实现方案保持一致

2. 开发个人评估修改的范围，明确改动点，确认改动范围

   - 如果修改了公共组件，或公共方法，需在小组群里发出来，确保自己的修改不会影响其他的调用
   - 如果要批量更换组件，需与当前值班测试和小组长一起评估影响范围，及发布形式
   - 需求确认完毕，要在效率上进行任务拆分，设置到期时间，一般为下个周四，如果不能按期完成，记得修改到期时间，同时知会对应的产品，达到闭环沟通

3. 如果有技术改造的项目，比如说升级 node，修改打包方式之类的，可以先建一个日常流程完整走一遍发布，不然 fastbuild 编译或者 ops 发布出了问题会阻塞快车整体的发布的

4. 如果确认为日常

   - 每周四的日常需要在`周一下午18:00之前`完成登记，登记的红色字段必填；`上车的截止时间为周二下午14:00`

   - 每周一 18:00 截止登记后，测试会进行文档梳理，描述不清楚的需求会标红提示，需要对应开发在`周二10:00前与值班测试同学沟通清楚`

   - 测试提供的 case 相当于核心冒烟用例，需开发自测通过，`冒烟case不通过直接下车，无修改机会`

   - 每个需求的影响面尽量全面，是否需要测试投入按需评估,PS:无需测试投入，由开发自测保证

   - 对于需求修改：

     - 明确范围内的修改未测试通过，直接下车
     - 明确范围外且不易评估的问题，最多修改一次

   - ```
     周二下班前，务必完成review
     ```

     ，尽量减少司机同学的合并工作

     - 提 review 之后，要及时通知当事人

   - 上车时，务必写清楚日常功能及影响范围，格式如下：

     修改内容：xiaolv 名称

     修改链接：xianlv 链接

     影响范围：XXX **\*`【影响范围务必明确清】`\***

   - `如果有项目依赖，如前后端依赖，相互确认，确保后端同学也已上本周日常`

   - 周二下午 14:00 会锁车，由司机同学发布到预发，开发验证完毕，由司机通知测试值班同学进行回归

   - 如果中间有下车情况，小伙伴们要注意以下几点：

     - 下车同学要全程关注，自己的代码确保不再本次日常的快车上；上车同学也确保自己的分支在快车上
     - 其他同学如有冲突需要处理，要先将本地的快车分支删掉，重新 pull 一下，再去 merge 自己的开发分支，处理冲突，提交代码

5. 发布后要务必进行线上回归，如有遗漏的 case，提醒测试同学完善

6. 发布后两小时内，记得关注一下知识付费答疑群，看是否有问题反馈，是否为个人日常引起，发现问题，先进行线上回滚，再回预发排查

## 司机

每周的日常，都会有专门的司机负责开车，（司机值班表：[发车值班表] 司机的职责如下：

1. 每周五早上创建下周日常班车（发车指南：[日常值班指南]），目前是快车，车名 【前端】20181213 合并发布(日期为发布日)，在【有赞日常&项目发布】群告知测试一下本周值班人员，并在【前端大本营】群@所有人把需求上车，没有登记的登记一下，登记务必填写对应产品，有顺序依赖务必备注。
2. 周二下午 14:00 锁车，把所有代码发布到预发 sc，通知开发自测，全部自测通过后通知测试验收
3. 周四 12 点之前合并代码（先反合 master，打包，然后提 mr）之前，`帮忙check一下日常的commit信息，确保快车分支的提交记录与平台上的分支一致`，然后预发发 master 通知对应开发同学确保个人修改生效，测试同学做最后回归, 可借助[visgo 脚本执行]，提高效率
4. 下午 3 点之前提发布单
5. 下班回家记得带电脑

# 项目发布规范

> 项目开发完成,测试/验收后，就坐等发布了，此时也要很细心谨慎，不能再最后一个环境出问题呢。

现在的前端应用比较多，每个业务线都有自己的项目，主的发布流程如图 1 所示。交叉的需求，可能会需要修改其他的项目。对于不同的应用，在发布之前的注意点会略有不同。

![img](https://b.yzcdn.cn/public_files/2019/03/27/project-release.png)

图 1 项目发布流程图

## 外部应用

1. 发布之前完成组内 review
2. 在进行合并 master，开发分支打包后，务必仔细 diff 一下代码，确保所有变更都是明确的，尤其对于基础库的版本变更，要及时跟应用 owner 确认
3. 提 mr 进行代码合并时，要在 title 中明确此次提交的内容，私信给对应的同学，明确影响范围，一起评估是否需要回归其他 case

## 内部应用

按照图 1 流程进行发布即可。
